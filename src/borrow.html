<!DOCTYPE html>
<html lang="en">

	<head>
		<title>Borrow</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="Bluesky template project">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
		<link href="plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.carousel.css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.theme.default.css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/animate.css">
		<link rel="stylesheet" type="text/css" href="styles/about.css">
		<link rel="stylesheet" type="text/css" href="styles/about_responsive.css">

		<style type="text/css">
			
			.custom_button
			{
				width: 193px;
				height: 100%;
				border-radius: 35px;
				border: none;
				outline: none;
				cursor: pointer;
				font-size: 14px;
				font-weight: 700;
				color: #FFFFFF;
				text-transform: uppercase;
				background: linear-gradient(to right, #487fee, #32fa95);
			}
		</style>
	</head>

	<body>

		<div class="super_container">

			<!-- Header -->
			<!-- Header is injected by js/header.js -->


			<!-- Menu -->
			<div class="menu trans_500">
				<div class="menu_content d-flex flex-column align-items-center justify-content-center text-center">
					<div class="menu_close_container"><div class="menu_close"></div></div>
					<div class="logo menu_logo">
						<a href="#">
							<div class="logo_container d-flex flex-row align-items-start justify-content-start">
								<div class="logo_image"><div><img src="images/trust_lend_logo.png" alt=""></div></div>
							</div>
						</a>
					</div>
					<ul>
						<li class="menu_item"><a href="index.html">Home</a></li>
						<li class="menu_item"><a href="borrow.html">Borrow</a></li>
						<li class="menu_item"><a href="lend.html">Lend</a></li>
						<li class="menu_item"><a href="wallet.html">My Wallet</a></li>
						<li class="menu_item"><a href="contact.html">Contact</a></li>
					</ul>
				</div>
				<div class="menu_phone"><span>call us: </span>9604 2093</div>
			</div>
			

			<!-- Home -->
			<div class="home" style="">
				<div class="parallax_background parallax-window" data-parallax="scroll" data-image-src="images/about.jpg" data-speed="0.8"></div>
				<div class="home_container">
					<div class="container">
						<div class="row">
							<div class="col">
								<div class="home_content d-flex flex-row align-items-end justify-content-start">
									<div class="home_title">Start Borrowing with a few clicks</div>
									<!-- <div class="breadcrumbs ml-auto">
										<ul>
											<li><a href="index.htmo">Home</a></li>
											<li>About us</li>
										</ul>
									</div> -->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>


			<!-- Home Search -->
			<div class="home_search">
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="home_search_container">
								<div class="home_search_content" style="display: flex;">
									<!-- <form action="#" class="search_form d-flex flex-row align-items-start justfy-content-start"> -->
										<div class="search_form_content d-flex flex-row align-items-start justfy-content-start flex-wrap">
											<div>
												<input id="input_borrowAmount" type="number" class="search_form_select" placeholder="Amount" required="required" style="background: white;">
											</div>
											<div style="border-right: none;width: 70%;margin-top: 10px;">
												<p id="user_credit_interest_amnt"></p>
											</div>
											<div style="visibility: hidden;">
												<select id="input_rateType" class="search_form_select" style="background: white;">
													<option disabled selected>Rate Type</option>
													<option>daily</option>
													<option>monthly</option>
													<option>annually</option>
												</select>
											</div>
											<div style="visibility: hidden;">
												<input id="input_interestRate" type="number" class="search_form_select" placeholder="Interest Rate: 5%" required="required" style="background: white;">
											</div>
										</div>
										<button class="custom_button" onclick='App_current_page.postBorrow();'>Post Borrow</button>
										<!-- <button class="custom_button" onclick='App_current_page.postBorrowMultiple();'>Test Borrow</button> -->
									<!-- </form> -->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>


			<!-- About -->
			<div class="about">
				<div class="container">
					<div class="row">

						<!-- About Content -->
						<div class="col-lg-6">
							<div class="about_content">
								<div class="section_title">How does Lend Trust work</div>
								<div class="section_subtitle">easy lending and borrowing powered by blockchain</div>
								<div class="about_text">
									<p>You borrow, you pay back. You lend, you get paid. Supervised by blockchain technology</p>
								</div>
							</div>
						</div>

						<!-- About Image -->
						<div class="col-lg-6">
							<div class="about_image"><img src="images/about_image.jpg" alt=""></div>
						</div>
					</div>
					<div class="row milestones_row">

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_1.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="651">0</div>
									<div class="milestone_text">Properties Sold</div>
								</div>
							</div>
						</div>

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_2.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="1256">0</div>
									<div class="milestone_text">Happy Clients</div>
								</div>
							</div>
						</div>

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_3.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="124">0</div>
									<div class="milestone_text">Buildings Sold</div>
								</div>
								
							</div>
						</div>

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_4.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="25">0</div>
									<div class="milestone_text">Awards Won</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>


			<!-- Realtors -->
			<div class="realtors">
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="section_title">Waiting for lender</div>
							<div class="section_subtitle">wait for a user to lend money to you</div>
						</div>
					</div>
					<div id="loans_need_lender" class="row realtors_row">
						<div style="width: 100%;text-align: center;">
							<p>You have no loan that needs lender</p>
						</div>
					</div>
				</div>
			</div>

			<div class="realtors">
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="section_title">Loans to be paid</div>
							<div class="section_subtitle">Manage the loans and payback in time</div>
						</div>
					</div>

					<div id="loans_need_payback" class="row realtors_row">
						<div style="width: 100%;text-align: center;">
							<p>You have no loan that needs to payback</p>
						</div>
					</div>
				</div>
			</div>

			<div class="realtors">
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="section_title">Loans ended</div>
							<div class="section_subtitle">See all the loans that had been paid</div>
						</div>
					</div>

					<div id="loans_is_done" class="row realtors_row">
						<div style="width: 100%;text-align: center;">
							<p>You have no loan that has ended</p>
						</div>
					</div>
				</div>
			</div>


			<!-- Newsletter -->
			<div class="newsletter" style="display: none;">
				<div class="parallax_background parallax-window" data-parallax="scroll" data-image-src="images/newsletter.jpg" data-speed="0.8"></div>
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="newsletter_content d-flex flex-lg-row flex-column align-items-start justify-content-start">
								<div class="newsletter_title_container">
									<div class="newsletter_title">Are you buying or selling?</div>
									<div class="newsletter_subtitle">Search your dream home</div>
								</div>
								<div class="newsletter_form_container">
									<form action="#" class="newsletter_form">
										<input type="email" class="newsletter_input" placeholder="Your e-mail address" required="required">
										<button class="newsletter_button">subscribe now</button>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Footer -->

			<footer class="footer" style="display: none;">
				<div class="footer_main">
					<div class="container">
						<div class="row">
							<div class="col-lg-3">
								<div class="footer_logo"><a href="#"><img src="images/logo_large.png" alt=""></a></div>
							</div>
							<div class="col-lg-9 d-flex flex-column align-items-start justify-content-end">
								<div class="footer_title">Latest Properties</div>
							</div>
						</div>
						<div class="row">
							<div class="col-lg-3 footer_col">
								<div class="footer_about">
									<div class="footer_about_text">Donec in tempus leo. Aenean ultricies mauris sed quam lacinia lobortis. Cras ut vestibulum enim, in gravida nulla. Curab itur ornare nisl at sagittis cursus.</div>
								</div>
							</div>
							<div class="col-lg-3 footer_col">
								<div class="footer_latest d-flex flex-row align-items-start justify-content-start">
									<div><div class="footer_latest_image"><img src="images/footer_latest_1.jpg" alt=""></div></div>
									<div class="footer_latest_content">
										<div class="footer_latest_location">Miami</div>
										<div class="footer_latest_name"><a href="#">Sea view property</a></div>
										<div class="footer_latest_price">$ 1. 234 981</div>
									</div>
								</div>
							</div>
							<div class="col-lg-3 footer_col">
								<div class="footer_latest d-flex flex-row align-items-start justify-content-start">
									<div><div class="footer_latest_image"><img src="images/footer_latest_2.jpg" alt=""></div></div>
									<div class="footer_latest_content">
										<div class="footer_latest_location">Miami</div>
										<div class="footer_latest_name"><a href="#">Town House</a></div>
										<div class="footer_latest_price">$ 1. 234 981</div>
									</div>
								</div>
							</div>
							<div class="col-lg-3 footer_col">
								<div class="footer_latest d-flex flex-row align-items-start justify-content-start">
									<div><div class="footer_latest_image"><img src="images/footer_latest_3.jpg" alt=""></div></div>
									<div class="footer_latest_content">
										<div class="footer_latest_location">Miami</div>
										<div class="footer_latest_name"><a href="#">Modern House</a></div>
										<div class="footer_latest_price">$ 1. 234 981</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="footer_bar" style="display: none;">
					<div class="container">
						<div class="row">
							<div class="col">
								<div class="footer_bar_content d-flex flex-row align-items-center justify-content-start">
									<div class="cr"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
										Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
										<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
									</div>
									<div class="footer_nav">
										<ul>
											<li><a href="index.html">Home</a></li>
											<li><a href="#">About us</a></li>
											<li><a href="properties.html">Properties</a></li>
											<li><a href="news.html">News</a></li>
											<li><a href="contact.html">Contact</a></li>
										</ul>
									</div>
									<div class="footer_phone ml-auto"><span>call us: </span>652 345 3222 11</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</footer>
		</div>

		<script src="js/header.js"></script>

		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="styles/bootstrap4/popper.js"></script>
		<script src="styles/bootstrap4/bootstrap.min.js"></script>
		<script src="plugins/greensock/TweenMax.min.js"></script>
		<script src="plugins/greensock/TimelineMax.min.js"></script>
		<script src="plugins/scrollmagic/ScrollMagic.min.js"></script>
		<script src="plugins/greensock/animation.gsap.min.js"></script>
		<script src="plugins/greensock/ScrollToPlugin.min.js"></script>
		<script src="plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
		<script src="plugins/easing/easing.js"></script>
		<script src="plugins/parallax-js-master/parallax.min.js"></script>
		<script src="js/about.js"></script>

		<script src="js/web3.min.js"></script>
		<script src="js/truffle-contract.js"></script>

		<!-- <script src="js/app.js"></script> -->

		<script type="text/javascript">

			$('#header_tab_2').addClass("active");

			// Webpage Logic Explained:
			// 1. Initialize Web3 Provider to get access to the blockchain
			// 2. Use the Web3 Instance to access account, access blockchain information

			// Webpage Function Explained:
			// 1. Get Current User Address - web3.eth.getCoinbase
			// 2. Post a borrow request - postBorrow
			// 3. Retrieve borrow list - getBorrowListLength()
			// 4. Show loans awaiting for lender - 

			var FLAG = 0;
			var loans_dict = new Object();
			var info_dict = new Object();
			var loans_dict_1 = new Object();
			var loans_dict_2 = new Object();
			var loans_dict_3 = new Object();
			var loans_info = {};
			var rate_type_convert = ["daily","monthly","annually"];

			var bc_user_credit = 0;
			var bc_user_int_rate = 0;
			var bc_user_max_amnt = 0;

			App_current_page = {
				web3Provider: null,
				contracts: {},
				account: '0x0',



				init: function() {
					console.log("#1. Initiating the borrow page")
					return App_current_page.initWeb3();
				},

				initWeb3: function() {
					console.log("#2. Initiating Web3 Provider")

					if (typeof web3 !== 'undefined') {
						// If a web3 instance is already provided by Meta Mask.
						App_current_page.web3Provider = web3.currentProvider;
						web3 = new Web3(web3.currentProvider);

						// Metamask requires us to ask for access to the user accounts
						// only when user agrees the access, can we use those information
						// Metamask will remember the user's option, so that the confirmation box will pop-up only once for each application
						try {
							// Request account access if needed
							ethereum.enable();
						} catch (error) {
							// User denied account access...
							console.log(error);
			          	}
					} else {
						// Specify default instance if no web3 instance provided
						App_current_page.web3Provider = new Web3.providers.HttpProvider('http://localhost:7545');
						web3 = new Web3(App_current_page.web3Provider);
					}
					return App_current_page.initContract();
				},

				initContract: function() {
					console.log("#3. Initiating the contract");

					$.getJSON("Manager.json", function(manager) {
						// Instantiate a new truffle contract from the artifact
						App_current_page.contracts.Manager = TruffleContract(manager);
						// Connect provider to interact with contract
						App_current_page.contracts.Manager.setProvider(App_current_page.web3Provider);
						return App_current_page.render();
					});

					$.getJSON("UserProfile.json", function(profileManager) {
					  // Instantiate a new truffle contract from the artifact
					  App_current_page.contracts.ProfileManager = TruffleContract(profileManager);
					  // Connect provider to interact with contract
					  App_current_page.contracts.ProfileManager.setProvider(App_current_page.web3Provider);
					  return App_current_page.render();
					});
				},

				render: function() {
					console.log("#4. Render the webpage");
					// 1. Get user account information
					// 2. Search for all borrow list
					// 3. Display loans that hasn't finished the fund raising
					// 4. Display loans that has finished fund raising, but not paid back
					// 5. Display loans that has finished the paid back

					var managerInstance;

				    // Load account data
				    web3.eth.getCoinbase(function(err, account) {
				    	if (err === null) {
				    		App_current_page.account = account;
				    		console.log("Borrow Page account is :", account);
				    		$('#header_user_address').html("User : "+account.substring(0,4)+` ... `+account.substring(account.length-5,account.length));
				    	}
				    });

				    App_current_page.contracts.ProfileManager.deployed().then(function(instance) {
				    	return instance.getUserName(App_current_page.account.toLowerCase(),{from: App_current_page.account});
				    }).then(function(name){
				    	console.log("have name: ", name);
				    	$('#header_user_address').html("User : "+name);
				    }).catch(function(error){
				    	console.warn(error);
				    });

				    // showing all the borrow list
				    App_current_page.contracts.Manager.deployed().then(function(instance) {
				    	managerInstance = instance;
				    	return managerInstance.getBorrowListLength();
				    }).then(function(totalNumber){
				    	if(Number(totalNumber)){
				    		console.log("Render: Retrieve user's borrow history");
				    		console.log("Render: total number of borrow: ",Number(totalNumber));
				    		FLAG = 1;
				    		App_current_page.showResultInSequence(0,Number(totalNumber),managerInstance);
				    	}
				    }).catch(function(error){
				    	console.warn(error);
				    });

				    // getUserCredit
					App_current_page.contracts.Manager.deployed().then(function(instance) {
				    	managerInstance = instance;
				    	return managerInstance.getUserCredit();
				    }).then(function(totalNumber){
				    	if(Number(totalNumber)){
				    		console.log("Render: user credit: ",Number(totalNumber));
				    		bc_user_credit = Number(totalNumber);
				    		FLAG = 1;
				    		// App_current_page.showResultInSequence(0,Number(totalNumber),managerInstance);
				    	}
				    }).catch(function(error){
				    	console.warn(error);
				    });

				    // getUserCredit
					App_current_page.contracts.Manager.deployed().then(function(instance) {
				    	managerInstance = instance;
				    	return managerInstance.calculateInterestRate(App_current_page.account);
				    }).then(function(totalNumber){
				    	if(Number(totalNumber)){
				    		console.log("Render: user interest rate: ",Number(totalNumber));
				    		bc_user_int_rate = Number(totalNumber);
				    		FLAG = 1;
				    		// App_current_page.showResultInSequence(0,Number(totalNumber),managerInstance);
				    	}
				    }).catch(function(error){
				    	console.warn(error);
				    });

				    // getUserMaximumBorrowAmount
				    App_current_page.contracts.Manager.deployed().then(function(instance) {
				    	managerInstance = instance;
				    	return managerInstance.getUserMaximumBorrowAmount();
				    }).then(function(totalNumber){
				    	if(Number(totalNumber)){
				    		console.log("Render: user max borrow: ",Number(totalNumber)/Math.pow(10,18));
				    		FLAG = 1;
				    		bc_user_max_amnt = Number(totalNumber)/Math.pow(10,18);
				    		// App_current_page.showResultInSequence(0,Number(totalNumber),managerInstance);
				    		text = "Credit: "+bc_user_credit+". Interest rate: "+bc_user_int_rate+"%.<br> Maximum borrow amount will be limited at: "+bc_user_max_amnt;

				    		$('#user_credit_interest_amnt').html(text);
				    	}
				    }).catch(function(error){
				    	console.warn(error);
				    });

				    


				},

				showResultInSequence: function(index, end, instance){
					// Show result logic:
					// 0. Now I have the total number of borrow object
					// 1. Retrieve borrow object one by one
					// 2. Only when the object is mine, proceed to following step
					// 3. Add all to the dicttionary: info_dict


					// 3. Fund raising is not finish - 
					// 4. Fund raising is finished, but not debt not cleared -
					// 5. Fund raising is finished, and the debt is cleared -

					if(index>end){
						return;
					}else{
						// getBorrowInfoFromBorrowList function will return:
						/*
						returns(uint256 borrow_index, 
								uint256 debt_index, 
								uint256 lenderNumber, 
								uint256 interest_rate, 
								address borrower, 
								uint256 amount_request, 
								uint256 amount_to_pay, 
								uint256 last_repay_time, 
								uint256 next_repay_time, 
								bool is_lend, 
								bool is_pay_off)
						*/
						instance.getBorrowInfoFromBorrowList(index).then(function(record){

							// console.log("Every Borrow Record: ");
							// console.log("borrow_index: ",Number(record[0]));
							// console.log("debt_index: ",Number(record[1]));
							// console.log("lenderNumber: ",Number(record[2]));
							// console.log("interest_rate: ",Number(record[3]));
							// console.log("borrower: ",record[4]);
							// console.log("amount_request: ",Number(record[5]));
							// console.log("amount_to_pay: ",Number(record[6]));
							// console.log("last_repay_time: ",Number(record[7]));
							// console.log("next_repay_time: ",Number(record[8]));
							// console.log("is_lend: ",Number(record[9]));
							// console.log("is_pay_off: ",Number(record[10]));


							if(record[4] == App_current_page.account){
								info_dict[index]={};

								info_dict[index]["borrow_index"] = Number(record[0]);
								info_dict[index]["debt_index"] = Number(record[1]);
								info_dict[index]["lenderNumber"] = Number(record[2]);
								info_dict[index]["interest_rate"] = Number(record[3]);
								info_dict[index]["borrower"] = record[4];
								info_dict[index]["amount_request"] = Number(record[5]);
								info_dict[index]["amount_to_pay"] = Number(record[6]);
								info_dict[index]["last_repay_time"] = Number(record[7]);
								info_dict[index]["next_repay_time"] = Number(record[8]);
								info_dict[index]["is_lend"] = Number(record[9]);
								info_dict[index]["is_pay_off"] = Number(record[10]);

								// other info requested from blockchain
								// info_dict[index]["is_pay_off"] = Number(record[10]);

						  		// for(var key in info_dict){
						  		// 	console.log("now dict:", info_dict[key]);
						  		// }
						  	}

						  	// at the last, insert all grids
						  	if(index==end-1){
						  		if(FLAG == 1){
						  			FLAG=0;
						  			insertGrid();
						  		}
						  	}
						  	App_current_page.showResultInSequence(index+1,end,instance);
						});
					}
				},

				postBorrowMultiple: function(){
					// *** Current Function ***
				    var amount = 2;
				    amount = amount*Math.pow(10,18);
				    console.log("Test borrow: ", amount);

				    App_current_page.contracts.Manager.deployed().then(async function(instance){
			    		// The sol function: 
			    		// function postBorrow(uint256 require_amount) public returns(bool)
			    		await instance.postBorrow(amount,{from: App_current_page.account});
			    		await instance.postBorrow(amount,{from: App_current_page.account});
			    		await instance.postBorrow(amount,{from: App_current_page.account});
			    		await instance.postBorrow(amount,{from: App_current_page.account});

			    	}).then(function(result){
			    		App_current_page.render();
			    	}).catch(function(err){
			    		console.error(err);
			    	});
				},

				postBorrow: function(){
					var amount = $('#input_borrowAmount').val();
					if(amount<=0){
				    	alert("Borrow amount should greater than 0");
				    	return;
				    }else if(amount>bc_user_max_amnt){
				    	alert("Borrow amount should no more than "+bc_user_max_amnt);
				    	return;
				    }

					// *** Current Function ***
				    var amount = $('#input_borrowAmount').val();
				    amount = amount*Math.pow(10,18);
				    console.log("I want to borrow: ", amount);

				    App_current_page.contracts.Manager.deployed().then(function(instance){
			    		// The sol function: 
			    		// function postBorrow(uint256 require_amount) public returns(bool)
			    		return instance.postBorrow(amount,{from: App_current_page.account});

			    	}).then(function(result){
			    		App_current_page.render();
			    	}).catch(function(err){
			    		console.error(err);
			    	});

			    	// *** Historical Function ***

			    	// var amount = $('#postBorrow_amount').val();

				    // var amount = $('#input_borrowAmount').val();
				    // var rate_type_string = $('#input_rateType').val();
				    // var rate_type = 0;
				    // var min_interest_rate = 5;
				    // var interest_Rate = $('#input_interestRate').val();

				    // if(rate_type_string=="daily"){
				    // 	rate_type=1;
				    // }else if(rate_type_string=="monthly"){
				    // 	rate_type=2;
				    // }else if(rate_type_string=="annually"){
				    // 	rate_type=3;
				    // }

				    // if(amount<=0){
				    // 	alert("Borrow amount should greater than 0");
				    // }else if(rate_type != 1 && rate_type != 2 && rate_type != 3){
				    // 	alert("Please select a valid rate type");
				    // }else if(interest_Rate<=0 || interest_Rate>=100){
				    // 	alert("Interest rate should within 0 to 100");
				    // }else if(interest_Rate<min_interest_rate){
				    // 	alert("According to your credit level, your loan should have an minimun interest rate of "+min_interest_rate+"%");
				    // }else{
				    // 	App_current_page.contracts.Manager.deployed().then(function(instance){
				    // 		// The sol function: 
				    // 		// function postBorrow(uint256 require_amount) public returns(bool)
				    // 		return instance.postBorrow(amount,{from: App_current_page.account});
				    // 		// return instance.postBorrow(amount,rate_type,{from: App_current_page.account});
				    // 	}).then(function(result){
				    // 		App_current_page.render();
				    // 	}).catch(function(err){
				    // 		console.error(err);
				    // 	});
				    // }
				},

				payLoan: function(index,amoutToPay){
					result = $('#payback_amount_'+index).val();
					amoutToPay = amoutToPay;
					if(!result){
						// confirm = confirm("Since you didn't enter the amount to pay, you need to pay accumulated value of: "+amoutToPay);
						result = amoutToPay;
						if(confirm("Since you didn't enter the amount to pay, you need to pay accumulated value of: "+amoutToPay/Math.pow(10,18)+" ether")){
							App_current_page.performPayLoan(index,result);
						}else{
							App_current_page.render();
						}
					}else{
						if(result>amoutToPay){
							alert("You should not pay more than: "+amoutToPay);
						}else if(result<=0){
							alert("You should pay more than: 0");
						}else{
							// confirm = confirm("You will pay back: "+result);
							if(confirm("You will pay back: "+result)){
								App_current_page.performPayLoan(index,result);
							}else{
								// App_current_page.render();
							}
						}
					}
				},

				performPayLoan: function(index, amount){
					App_current_page.contracts.Manager.deployed().then(function(instance){
						instance.payLoan(index,{from: App_current_page.account, value: amount});
					}).then(function(){
						App_current_page.render();
					}).catch(function(err){
						console.error(err);
					});
				},
			};

			function insertGrid (){
				$('#loans_need_lender').html("");
				$('#loans_need_payback').html("");
				$('#loans_is_done').html("");

				for(var key in info_dict){
					if(info_dict[key]["is_lend"]==0){
						// not finish the fund raising process
						new_grid_html = `
					  		<div id="`+"loan_need_lender"+key+`"class="col-lg-4 col-md-6">
					  		<div class="realtor_outer">
					  		<div class="realtor">
					  		<div class="realtor_image"><img src="images/trust_lend_logo_temp.png" alt=""></div>
					  		<div class="realtor_body">
					  		<div class="realtor_title">Amount: `+info_dict[key]["amount_request"]/Math.pow(10,18)+`</div>
					  		<div class="realtor_subtitle" style="display: none;">Rate Type: `+1+`</div>
					  		<div class="realtor_subtitle">Interest Rate: `+info_dict[key]["interest_rate"]+`%</div>
					  		</div>

					  		<div class="realtor_link" style="display:none;">
					  		<button class="search_form_button ml-auto" onclick='' style="width:50px;">Pay</button>
					  		</div>
					  		</div>
					  		<div class="realtor_link_background_container" style="display:none;">
					  		<div><div class="realtor_link_background"></div></div>
					  		</div>
					  		</div>
					  		</div>
					  	`;
					  	$('#loans_need_lender').append(new_grid_html);
					}else{

						is_pay_off = info_dict[key]["is_pay_off"];

						new_grid_html = `
					  		<div id="`+"loan_need_lender"+key+`"class="col-lg-4 col-md-6">
					  		<div class="realtor_outer">
					  		<div class="realtor">
					  		<div class="realtor_image"><img src="images/trust_lend_logo_temp.png" alt=""></div>
					  		<div class="realtor_body style="padding-bottom:10px;">
					  		<div class="realtor_title">Amount Borrowed: `+info_dict[key]["amount_request"]/Math.pow(10,18)+`</div>
					  	`;

				  		if(!is_pay_off){
				  			new_grid_html += `
				  				<div id="amount_to_pay_for_a_loan_`+key+`"" class="realtor_title">Amount To Pay: `+info_dict[key]["amount_to_pay"]/Math.pow(10,18)+`</div>
				  			`
				  		}else{
				  			new_grid_html += `
				  				<div class="realtor_title">Amount Paid: `+0+`</div>
				  			`
				  		}

				  		new_grid_html += `
					  		<div class="realtor_subtitle" style="display: none;">Rate Type: `+1+`</div>
					  		<div class="realtor_subtitle">Interest Rate: `+info_dict[key]["interest_rate"]+`%</div>
					  		</div>
				  		`;

				  		if(!is_pay_off){
				  			new_grid_html += `
					  			<div class="realtor_title">
					  				<input id="payback_amount_`+key+`" type="number" name="paybackAmount" placeholder="Default: Fully pay `+info_dict[key]["amount_to_pay"]/Math.pow(10,18)+`" style="height: 40px;width: 80%;border-top: none;text-align: center;border-left: none;border-right: none;margin-bottom: 10px;display: block;margin-left: 10%;outline:none;"><br>
					  			</div>
					  			<div class="realtor_link" style="display:visible;">
				  			`;
				  		}else{
				  			new_grid_html += `
				  				<div class="realtor_link" style="display:none;">
				  			`;
				  		}

				  		new_grid_html += `
					  		<button class="search_form_button ml-auto" onclick='App_current_page.payLoan(`+info_dict[key]["debt_index"]+`,`+info_dict[key]["amount_to_pay"]+`);' style="width:50px;outline:none;">
					  			Pay
					  		</button>
					  		</div>
					  		</div>
					  		<div class="realtor_link_background_container" style="display:none;">
					  		<div><div class="realtor_link_background"></div></div>
					  		</div>
					  		</div>
					  		</div>
				  		`;

				  		if(is_pay_off){
				  			$('#loans_is_done').append(new_grid_html);
				  		}else{
				  			$('#loans_need_payback').append(new_grid_html);
				  		}

					}
				}
			};

			$(function() {
				$(window).on('load',function() {
					App_current_page.init();
				});
			});

		</script>
	</body>
</html>