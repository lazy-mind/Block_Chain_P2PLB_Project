<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Lend</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="Bluesky template project">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
		<link href="plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.carousel.css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.theme.default.css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/animate.css">
		<link rel="stylesheet" type="text/css" href="styles/about.css">
		<link rel="stylesheet" type="text/css" href="styles/about_responsive.css">
		<link rel="stylesheet" type="text/css" href="styles/main_styles.css">
		<link rel="stylesheet" type="text/css" href="styles/responsive.css">

		<style type="text/css">
			.custom_button
			{
				width: 193px;
				height: 100%;
				border-radius: 35px;
				border: none;
				outline: none;
				cursor: pointer;
				font-size: 14px;
				font-weight: 700;
				color: #FFFFFF;
				text-transform: uppercase;
				background: linear-gradient(to right, #487fee, #32fa95);
			}
		</style>
	</head>
	
	<body>

		<div class="super_container">

			<!-- Header -->

			<!-- Menu -->

			<div class="menu trans_500">
				<div class="menu_content d-flex flex-column align-items-center justify-content-center text-center">
					<div class="menu_close_container"><div class="menu_close"></div></div>
					<div class="logo menu_logo">
						<a href="#">
							<div class="logo_container d-flex flex-row align-items-start justify-content-start">
								<div class="logo_image"><div><img src="images/trust_lend_logo.png" alt=""></div></div>
							</div>
						</a>
					</div>
					<ul>
						<li class="menu_item"><a href="index.html">Home</a></li>
						<li class="menu_item"><a href="borrow.html">Borrow</a></li>
						<li class="menu_item"><a href="lend.html">Lend</a></li>
						<li class="menu_item"><a href="wallet.html">My Wallet</a></li>
						<li class="menu_item"><a href="contact.html">Contact</a></li>
					</ul>
				</div>
				<div class="menu_phone"><span>call us: </span>9604 2093</div>
			</div>

			<!-- Home -->

			<div class="home" style="">
				<div class="parallax_background parallax-window" data-parallax="scroll" data-image-src="images/about.jpg" data-speed="0.8"></div>
				<div class="home_container">
					<div class="container">
						<div class="row">
							<div class="col">
								<div class="home_content d-flex flex-row align-items-end justify-content-start">
									<div class="home_title">Lend money and gain profit</div>
								<!-- <div class="breadcrumbs ml-auto">
									<ul>
										<li><a href="index.htmo">Home</a></li>
										<li>About us</li>
									</ul>
								</div> -->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Home Search -->
		<div class="home_search">
			<div class="container">
				<div class="row">
					<div class="col">
						<div class="home_search_container">
							<div class="home_search_content" style="display: flex;">
								<div class="search_form_content d-flex flex-row align-items-start justfy-content-start flex-wrap">
										<!-- <div>
											<select id="search_interest_rate" class="search_form_select">
												<option disabled selected>Interest Rate</option>
												<option>0% - 3%</option>
												<option>3% - 5%</option>
												<option>5% - 7%</option>
												<option>7% - 10%</option>
												<option>10% - 13%</option>
												<option>13% - 17%</option>
												<option>17% - 20%</option>
											</select>
										</div> -->
										<div style="width: 22%;vertical-align: middle;display: grid;">
											<input style = "border: none;outline: none;" id="search_interest_rate" class="search_form_input" type="number" placeholder="interest rate > 0%" name="Interest_Rate">
										</div>
										<div style="width: 22%;vertical-align: middle;display: grid;">
											<select id="search_interest_rate_type" class="search_form_select" style="background: white;display: none;">
												<option disabled selected>Rate Type</option>
												<option>daily</option>
												<option>monthly</option>
												<option>annually</option>
											</select>
										</div>
										<div style="width: 22%;vertical-align: middle;display: grid;">
											<input style = "border: none;outline: none;" id="search_amount_min" class="search_form_input" type="number" placeholder="min amount" name="Amount">
										</div>
										<div style="width: 22%;vertical-align: middle;display: grid;">
											<input style = "border: none;outline: none;" id="search_amount_max" class="search_form_input" type="number" placeholder="max amount" name="Amount">
										</div>
										<!-- <div>
											<select id="search_payback_time" class="search_form_select">
												<option disabled selected>Payback Time</option>
												<option>6 months</option>
												<option>12 months</option>
												<option>18 months</option>
												<option>24 months</option>
											</select>
										</div>
										<div>
											<select id="search_currency_type" class="search_form_select">
												<option disabled selected>Currency types</option>
												<option>USD</option>
												<option>HKD</option>
												<option>RMB</option>
												<option>EUR</option>
											</select>
										</div>
										<div>
											<select id="search_flexible_return" class="search_form_select">
												<option disabled selected>Flexible return</option>
												<option>Yes</option>
												<option>No</option>
											</select>
										</div> -->
										<!-- <div>
											<select class="search_form_select">
												<option disabled selected>Bathrooms</option>
												<option>1</option>
												<option>2</option>
												<option>3</option>
											</select>
										</div> -->
									</div>
									<button class="custom_button" onclick="App_current_page.searchBorrow()">search</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>



			<div id="search_result_div" style="display: none;" class="realtors">
				<div class="container">
					<div class="row realtors_row">
						<div class="recent_slider_container">
							<div id="loans_need_lender" class="" style="    display: inline-flex;">

							</div>

							<div class="recent_slider_nav_container d-flex flex-row align-items-start justify-content-start">
								<div class="recent_slider_nav recent_slider_prev"><i class="fa fa-chevron-left" aria-hidden="true"></i></div>
								<div class="recent_slider_nav recent_slider_next"><i class="fa fa-chevron-right" aria-hidden="true"></i></div>
							</div>
						</div>
						<div class="button recent_button" onclick="App_current_page.clearSearch()" style="cursor: pointer;"><a style="color: white;">Close Search</a></div>
					</div>
				</div>
			</div>

			<!-- About -->

			<div class="about">
				<div class="container">
					<div class="row">

						<!-- About Content -->
						<div class="col-lg-6">
							<div class="about_content">
								<div class="section_title">How does "Lending" work</div>
								<div class="section_subtitle">easy lending and borrowing powered by blockchain</div>
								<div class="about_text">
									<p>You lend the money to a loan, you wait for the borrower to pay back to you. Also, you can see what loan have you lent and which of them are not payback. You can urge the borrower to payback and you can see a borrower's recent loans that you are interested to invest in.</p>
								</div>
							</div>
						</div>

						<!-- About Image -->
						<div class="col-lg-6">
							<div class="about_image"><img src="images/about_image.jpg" alt=""></div>
						</div>
					</div>
					<div class="row milestones_row">

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_1.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="651">0</div>
									<div class="milestone_text">Properties Sold</div>
								</div>
							</div>
						</div>

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_2.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="1256">0</div>
									<div class="milestone_text">Happy Clients</div>
								</div>
							</div>
						</div>

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_3.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="124">0</div>
									<div class="milestone_text">Buildings Sold</div>
								</div>

							</div>
						</div>

						<!-- Milestone -->
						<div class="col-lg-3 milestone_col">
							<div class="milestone d-flex flex-row align-items-center justify-content-start">
								<div class="milestone_icon d-flex flex-column align-items-center justify-content-center"><img src="images/milestones_4.png" alt=""></div>
								<div class="milestone_content">
									<div class="milestone_counter" data-end-value="25">0</div>
									<div class="milestone_text">Awards Won</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>

			<!-- Realtors -->

			<div class="realtors">
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="section_title">Waiting for payback</div>
							<div class="section_subtitle">wait for the borrower to pay back money to you</div>
						</div>
					</div>
					<div id="waiting_for_payback" class="row realtors_row">
						<div style="width: 100%;text-align: center;">
							<p>You have no lent that is waiting for a payback</p>
						</div>
					</div>
				</div>
			</div>

			<div class="realtors">
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="section_title">Lent history</div>
							<div class="section_subtitle">See the lending record</div>
						</div>
					</div>
					<div id="finished_lent" class="row realtors_row">
						<div style="width: 100%;text-align: center;">
							<p>You have no lent that is finished</p>
						</div>
					</div>
				</div>
			</div>

			<!-- Newsletter -->

			<div class="newsletter" style="display: none;">
				<div class="parallax_background parallax-window" data-parallax="scroll" data-image-src="images/newsletter.jpg" data-speed="0.8"></div>
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="newsletter_content d-flex flex-lg-row flex-column align-items-start justify-content-start">
								<div class="newsletter_title_container">
									<div class="newsletter_title">Are you buying or selling?</div>
									<div class="newsletter_subtitle">Search your dream home</div>
								</div>
								<div class="newsletter_form_container">
									<form action="#" class="newsletter_form">
										<input type="email" class="newsletter_input" placeholder="Your e-mail address" required="required">
										<button class="newsletter_button">subscribe now</button>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Footer -->

			<footer class="footer" style="display: none;">
				<div class="footer_main">
					<div class="container">
						<div class="row">
							<div class="col-lg-3">
								<div class="footer_logo"><a href="#"><img src="images/logo_large.png" alt=""></a></div>
							</div>
							<div class="col-lg-9 d-flex flex-column align-items-start justify-content-end">
								<div class="footer_title">Latest Properties</div>
							</div>
						</div>
						<div class="row">
							<div class="col-lg-3 footer_col">
								<div class="footer_about">
									<div class="footer_about_text">Donec in tempus leo. Aenean ultricies mauris sed quam lacinia lobortis. Cras ut vestibulum enim, in gravida nulla. Curab itur ornare nisl at sagittis cursus.</div>
								</div>
							</div>
							<div class="col-lg-3 footer_col">
								<div class="footer_latest d-flex flex-row align-items-start justify-content-start">
									<div><div class="footer_latest_image"><img src="images/footer_latest_1.jpg" alt=""></div></div>
									<div class="footer_latest_content">
										<div class="footer_latest_location">Miami</div>
										<div class="footer_latest_name"><a href="#">Sea view property</a></div>
										<div class="footer_latest_price">$ 1. 234 981</div>
									</div>
								</div>
							</div>
							<div class="col-lg-3 footer_col">
								<div class="footer_latest d-flex flex-row align-items-start justify-content-start">
									<div><div class="footer_latest_image"><img src="images/footer_latest_2.jpg" alt=""></div></div>
									<div class="footer_latest_content">
										<div class="footer_latest_location">Miami</div>
										<div class="footer_latest_name"><a href="#">Town House</a></div>
										<div class="footer_latest_price">$ 1. 234 981</div>
									</div>
								</div>
							</div>
							<div class="col-lg-3 footer_col">
								<div class="footer_latest d-flex flex-row align-items-start justify-content-start">
									<div><div class="footer_latest_image"><img src="images/footer_latest_3.jpg" alt=""></div></div>
									<div class="footer_latest_content">
										<div class="footer_latest_location">Miami</div>
										<div class="footer_latest_name"><a href="#">Modern House</a></div>
										<div class="footer_latest_price">$ 1. 234 981</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="footer_bar" style="display: none;">
					<div class="container">
						<div class="row">
							<div class="col">
								<div class="footer_bar_content d-flex flex-row align-items-center justify-content-start">
									<div class="cr"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
										Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
										<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
									</div>
									<div class="footer_nav">
										<ul>
											<li><a href="index.html">Home</a></li>
											<li><a href="#">About us</a></li>
											<li><a href="properties.html">Properties</a></li>
											<li><a href="news.html">News</a></li>
											<li><a href="contact.html">Contact</a></li>
										</ul>
									</div>
									<div class="footer_phone ml-auto"><span>call us: </span>652 345 3222 11</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</footer>
		</div>

		<script src="js/header.js"></script>

		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="styles/bootstrap4/popper.js"></script>
		<script src="styles/bootstrap4/bootstrap.min.js"></script>
		<script src="plugins/greensock/TweenMax.min.js"></script>
		<script src="plugins/greensock/TimelineMax.min.js"></script>
		<script src="plugins/scrollmagic/ScrollMagic.min.js"></script>
		<script src="plugins/greensock/animation.gsap.min.js"></script>
		<script src="plugins/greensock/ScrollToPlugin.min.js"></script>
		<script src="plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
		<script src="plugins/easing/easing.js"></script>
		<script src="plugins/parallax-js-master/parallax.min.js"></script>
		<script src="js/about.js"></script>

		<script src="js/web3.min.js"></script>
		<script src="js/truffle-contract.js"></script>
		
		<!-- <script src="js/app.js"></script> -->
		<!-- getUserDebtStatus -->

		<script type="text/javascript">

			$('#header_tab_3').addClass("active");
			// Webpage Logic Explained:
			// 1. Initialize Web3 Provider to get access to the blockchain
			// 2. Use the Web3 Instance to access account, access blockchain information

			// Webpage Function Explained:
			// 1. Get Current User Address - web3.eth.getCoinbase
			// 3. Retrieve Lend list - 
			// 4. Show lend information - 

			var FLAG = 0;
			var loans_dict = new Object();
			var info_dict = new Object();
			var rate_type_convert = ["daily","monthly","annually"];

			var search_interest_rate = 0;
			var search_interest_rate_type = 0;
			var search_amount_min = 0;
			var search_amount_max = 0;

			App_current_page = {
				web3Provider: null,
				contracts: {},
				account: '0x0',

				init: function() {
					console.log("#1. Initiating the borrow page")
					return App_current_page.initWeb3();
				},

				initWeb3: function() {
					console.log("#2. Initiating Web3 Provider")

					if (typeof web3 !== 'undefined') {
						// If a web3 instance is already provided by Meta Mask.
						App_current_page.web3Provider = web3.currentProvider;
						web3 = new Web3(web3.currentProvider);

						// Metamask requires us to ask for access to the user accounts
						// only when user agrees the access, can we use those information
						// Metamask will remember the user's option, so that the confirmation box will pop-up only once for each application
						try {
							// Request account access if needed
							ethereum.enable();
						} catch (error) {
							// User denied account access...
							console.log(error);
			          	}
					} else {
						// Specify default instance if no web3 instance provided
						App_current_page.web3Provider = new Web3.providers.HttpProvider('http://localhost:7545');
						web3 = new Web3(App_current_page.web3Provider);
					}
					return App_current_page.initContract();
				},

				initContract: function() {
					console.log("#3. Initiating the contract");

					$.getJSON("Manager.json", function(manager) {
						// Instantiate a new truffle contract from the artifact
						App_current_page.contracts.Manager = TruffleContract(manager);
						// Connect provider to interact with contract
						App_current_page.contracts.Manager.setProvider(App_current_page.web3Provider);
						return App_current_page.render();
					});

					$.getJSON("UserProfile.json", function(profileManager) {
					  // Instantiate a new truffle contract from the artifact
					  App_current_page.contracts.ProfileManager = TruffleContract(profileManager);
					  // Connect provider to interact with contract
					  App_current_page.contracts.ProfileManager.setProvider(App_current_page.web3Provider);
					  return App_current_page.render();
					});
				},

				render: function() {
					console.log("#4. Render the webpage");
					// 1. Get user account information
					// 2. Search for all lend list
					// 3. Display loans that are not cleared
					// 4. Display loans that are cleared

					var managerInstance;

				    // Load account data
				    web3.eth.getCoinbase(function(err, account) {
				    	if (err === null) {
				    		App_current_page.account = account;
				    		console.log("Lend Page account is :", account);
				    		$('#header_user_address').html("User : "+account.substring(0,4)+` ... `+account.substring(account.length-5,account.length));
				    	}
				    });

				    App_current_page.contracts.Manager.deployed().then(function(instance) {
				    	managerInstance = instance;
				    	return managerInstance.getLendListLength();
				    }).then(function(totalNumber){
				    	if(Number(totalNumber)){
				    		console.log("Render: Retrieve user's lend history");
				    		console.log("Render: total number of lend: ",Number(totalNumber));
				    		FLAG = 1;
				    		App_current_page.showResultInSequence(0,Number(totalNumber),managerInstance);
				    	}
				    }).catch(function(error){
				    	console.warn(error);
				    });


				    // Deploy the contract to show the borrow list
				    App_current_page.contracts.Manager.deployed().then(function(instance) {
				    	managerInstance = instance;
				    	return managerInstance.getBorrowListLength();
				    }).then(function(totalNumber){
				    	FLAG = 1;
				    	if(Number(totalNumber)){
				    		console.log("totoal number of loans that can lend to: ",Number(totalNumber));
				    		App_current_page.getBorrowResultInSequence(0,Number(totalNumber),managerInstance);
				    	}
				    }).catch(function(error){
				    	console.warn(error);
				    });

				    App_current_page.contracts.ProfileManager.deployed().then(function(instance) {
				    	return instance.getUserName(App_current_page.account.toLowerCase(),{from: App_current_page.account});
				    }).then(function(name){
				    	console.log("have name: ", name);
				    	$('#header_user_address').html("User : "+name);
				    }).catch(function(error){
				    	console.warn(error);
				    });
				},

				showResultInSequence: function(index, end, instance){
					// Show result logic:
					// 0. Now I have the total number of ledn object
					// 1. Retrieve lend object one by one
					// 2. Only when the object is mine, proceed to following step
					// 3. Add all to the dicttionary: info_dict

					if(index>end){
						return;
					}else{
						// getLendInfoFromBorrowList function will return:
						/*
						returns(uint256 lend_index, 
								uint256 debt_index, 
								address lenderAddress, 
								uint256 lend_amount, 
								uint256 amount_remain, 
								bool is_pay_off)
						*/
						instance.getLendInfoFromBorrowList(index).then(function(record){

							console.log("Every Lend Record: ");
							console.log("lend_index: ",Number(record[0]));
							console.log("debt_index: ",Number(record[1]));
							console.log("lenderAddress: ",record[2]);
							console.log("lend_amount: ",Number(record[3]));
							console.log("amount_remain: ",Number(record[4]));
							console.log("is_pay_off: ",Number(record[5]));


							if(record[2] == App_current_page.account){
								info_dict[index]={};

								info_dict[index]["lend_index"] = Number(record[0]);
								info_dict[index]["debt_index"] = Number(record[1]);
								info_dict[index]["lenderAddress"] = record[2];
								info_dict[index]["lend_amount"] = Number(record[3]);
								info_dict[index]["amount_remain"] = Number(record[4]);
								info_dict[index]["is_pay_off"] = Number(record[5]);
						  	}

						  	// at the last, insert all grids
						  	if(index==end-1){
						  		if(FLAG == 1){
						  			FLAG=0;
						  			insertGridLend();
						  		}
						  	}
						  	App_current_page.showResultInSequence(index+1,end,instance);
						});
					}
				},

				getBorrowResultInSequence: function (index, end, instance){
					if(index>end){
						return;
					}else{
						// getBorrowInfoFromBorrowList function will return:
						/*
						returns(uint256 borrow_index, 
								uint256 debt_index, 
								uint256 lenderNumber, 
								uint256 interest_rate, 
								address borrower, 
								uint256 amount_request, 
								uint256 amount_to_pay, 
								uint256 last_repay_time, 
								uint256 next_repay_time, 
								bool is_lend, 
								bool is_pay_off)
						*/

						instance.getBorrowInfoFromBorrowList(index).then(function(record){
							
							console.log("Every Borrow Record: ");
							console.log("borrow_index: ",Number(record[0]));
							console.log("debt_index: ",Number(record[1]));
							console.log("lenderNumber: ",Number(record[2]));
							console.log("interest_rate: ",Number(record[3]));
							console.log("borrower: ",record[4]);
							console.log("amount_request: ",Number(record[5]));
							console.log("amount_to_pay: ",Number(record[6]));
							console.log("last_repay_time: ",Number(record[7]));
							console.log("next_repay_time: ",Number(record[8]));
							console.log("is_lend: ",Number(record[9]));
							console.log("is_pay_off: ",Number(record[10]));

							if(record[4] != App_current_page.account){
								loans_dict[index]={};
								loans_dict[index]["borrower"] = record[4];
								loans_dict[index]["amountRequest"] = Number(record[5]);
								loans_dict[index]["amountToPay"] = Number(record[6]);
								loans_dict[index]["timeRecord"] = Number(record[7]);
								loans_dict[index]["rateType"] = 1;
								loans_dict[index]["interestRate"] = Number(record[3]);
								loans_dict[index]["isLend"] = Number(record[9]);;
								loans_dict[index]["isPayOff"] = Number(record[10]);;
						  		for(var key in loans_dict){
						  			// console.log("now dict:", loans_dict[key]);
						  		}
						  	}
						  	console.log("current at : index",index," end:",end);
						  	if(index==end-1){
						  		if(FLAG == 1){
						  			FLAG=0;
						  			console.log("where");
						  			insertGrid();
						  		}
						  	}
						  	showResultInSequence(index+1,end,instance);
						});
					}
				},

				searchBorrow: function(){

					if($('#search_interest_rate').val()){
						search_interest_rate = $('#search_interest_rate').val();
						console.log("search_interest_rate ",search_interest_rate);
					}
					if($('#search_interest_rate_type').val()){
						search_interest_rate_type = $('#search_interest_rate_type').val();
						if($('#search_interest_rate_type').val() == "daily"){
							search_interest_rate_type = 1;
						}else if($('#search_interest_rate_type').val() == "monthly"){
							search_interest_rate_type = 2;
						}else if($('#search_interest_rate_type').val() == "monthly"){
							search_interest_rate_type = 3;
						}
						console.log("search_interest_rate_type ",search_interest_rate_type);
					}
					if($('#search_amount_min').val()){
						search_amount_min = $('#search_amount_min').val();
						console.log("search_amount_min ",search_amount_min);
					}
					if($('#search_amount_max').val()){
						search_amount_max = $('#search_amount_max').val();
						console.log("search_amount_max ",search_amount_max);
					}	
					insertGrid();
				},

				clearSearch: function(){
					search_interest_rate = 0;
					search_interest_rate_type = 0;
					search_amount_min = 0;
					search_amount_max = 0;
					// loans_info = {};
					insertGrid();
				},

				lendMoney: function(index,value){
				  	// alert(index,value);
				  	// alert(value);
				  	index_to_lend = index;
				  	console.log("The borrow object index is: ",index);
				  	App_current_page.contracts.Manager.deployed().then(function(instance){
				  		return instance.lendMoney(index,{from: App_current_page.account, value: value});
				  	}).then(function(result){
				  		App_current_page.render();
				  	}).catch(function(err){
				  		console.error(err);
				  	});
				}
			};

			function insertGridLend(){
				$('#waiting_for_payback').html("");
				$('#finished_lent').html("");
				for(var key in info_dict){
					if(info_dict[key]["is_pay_off"]==0){
						// the loan is not cleared
					  	new_grid_html = `
							<div id="`+"loan_need_lender"+key+`"class="col-lg-3 col-md-6">
							<div class="realtor_outer">
							<div class="realtor">
							<div class="realtor_image"><img src="images/trust_lend_logo_temp.png" alt=""></div>
							<div class="realtor_body">
							<div class="realtor_title">Inital Lent Amount: `+info_dict[key]["lend_amount"]/Math.pow(10,18)+`</div>
							<div class="realtor_title">Remain Debt: `+info_dict[key]["amount_remain"]/Math.pow(10,18)+`</div>
							<div class="realtor_subtitle">Rate Type: `+1+`</div>
							<div class="realtor_subtitle">Interest Rate: `+0+`%</div>
							</div>

							<div class="realtor_link" style="display:none;">
							<button class="search_form_button ml-auto" onclick='' style="width:50px;">Pay</button>
							</div>
							</div>
							<div class="realtor_link_background_container" style="display:none;">
							<div><div class="realtor_link_background"></div></div>
							</div>
							</div>
							</div>
						`;
						$('#waiting_for_payback').append(new_grid_html);
					}else{
						new_grid_html = `
							<div id="`+"loan_need_lender"+key+`"class="col-lg-3 col-md-6">
							<div class="realtor_outer">
							<div class="realtor">
							<div class="realtor_image"><img src="images/trust_lend_logo_temp.png" alt=""></div>
							<div class="realtor_body">
							<div class="realtor_title">Inital Lent Amount: `+info_dict[key]["lend_amount"]/Math.pow(10,18)+`</div>
							<div class="realtor_title">Total Recieved: `+info_dict[key]["amount_remain"]/Math.pow(10,18)+`</div>
							<div class="realtor_subtitle">Rate Type: `+1+`</div>
							<div class="realtor_subtitle">Interest Rate: `+0+`%</div>
							</div>

							<div class="realtor_link" style="display:none;">
							<button class="search_form_button ml-auto" onclick='' style="width:50px;">Pay</button>
							</div>
							</div>
							<div class="realtor_link_background_container" style="display:none;">
							<div><div class="realtor_link_background"></div></div>
							</div>
							</div>
							</div>
						`;
						$('#finished_lent').append(new_grid_html);
					}
				}
			}

			function insertGrid2(){
				$('#search_result_div').removeAttr("style");
				$('#search_result_div').attr("display","visible");
				$('#loans_need_lender').html("");
				console.log("loans_dict:", loans_dict);
				console.log("Creating a grid");
				for(var key in loans_dict){
					console.log("now dict:", loans_dict[key]);
					if(loans_dict[key]["isLend"]==0){
						console.log("not lend yet");
						new_grid_html = `
						<div id="`+"loan_need_lender_"+key+`" class=" col-lg-4 col-md-6" color="`+key+`">
						<div class="realtor_outer">
						<div class="realtor">
						<div class="recent_item_image">
						<img src="images/property_1.jpg" alt="">
						<div class="tag_featured property_tag"><a href="#">5 Star Credit</a></div>
						</div>
						<div class="recent_item_body text-center" style="    padding-bottom: 60px;">
						<div class="recent_item_location"> Lend to: <br><br>`+(loans_dict[key]["borrower"]).substring(0,4)+` ... `+(loans_dict[key]["borrower"]).substring(loans_dict[key]["borrower"].length-5,loans_dict[key]["borrower"].length)+`</div>
						<div class="recent_item_title"><a href="property.html">Amount: `+loans_dict[key]["amountRequest"]+`</a></div>
						<div class="realtor_link" style="margin-top: 10px; margin-top: 5px;margin-bottom: 30px;">
						<button class="search_form_button ml-auto" onclick='App_current_page.lendMoney(`+key+`,`+loans_dict[key]["amountRequest"]+`);' style="width:50px;padding:3px;">Lend</button>
						</div>
						</div>
						<div class="recent_item_footer d-flex flex-row align-items-center justify-content-start">
						<div><div class="recent_icon"><img src="images/icon_2.png" alt="" style="display:none;"></div><span>Type: `+rate_type_convert[loans_dict[key]["rateType"]-1]+`</span></div>
						<div><div class="recent_icon"><img src="images/icon_3.png" alt="" style="display:none;"></div><span>Rate: `+loans_dict[key]["interestRate"]+`%</span></div>
						</div>
						</div>
						</div>
						</div>
						`;
						if(loans_dict[key]["interestRate"]>search_interest_rate && (loans_dict[key]["rateType"] == search_interest_rate_type || search_interest_rate_type == 0) && (loans_dict[key]["amountRequest"]>search_amount_min) && (loans_dict[key]["amountRequest"]<search_amount_max || search_amount_max == 0)){
							console.log("ADDED!!!!");
							$('#loans_need_lender').append(new_grid_html);
						}
					}
				}
			};

			function insertGrid (){
				$('#loans_need_lender').html("");
				console.log("loans_dict:", loans_dict);
				console.log("Creating a grid");
				for(var key in loans_dict){
				  	// console.log("now dict:", loans_dict[key]);
				  	if(loans_dict[key]["isLend"]==0){
				  		new_grid_html = `
				  		<div id="`+"loan_need_lender_"+key+`" class="owl-item col-lg-4 col-md-6" color="`+key+`">
				  		<div class="recent_item">
				  		<div class="recent_item_inner">
				  		<div class="recent_item_image">
				  		<img src="images/trust_lend_logo_temp.png" alt="">
				  		<div class="tag_featured property_tag"><a href="#">5 Star Credit</a></div>
				  		</div>
				  		<div class="recent_item_body text-center">
				  		<div class="recent_item_location"> Lend to: <br><br>`+(loans_dict[key]["borrower"]).substring(0,4)+` ... `+(loans_dict[key]["borrower"]).substring(loans_dict[key]["borrower"].length-5,loans_dict[key]["borrower"].length)+`</div>
				  		<div class="recent_item_title"><a href="property.html">Amount: `+loans_dict[key]["amountRequest"]/Math.pow(10,18)+`</a></div>
				  		<div class="realtor_link" style="margin-top: 10px;">
				  		<button class="search_form_button ml-auto" onclick='App_current_page.lendMoney(`+key+`,`+loans_dict[key]["amountRequest"]+`);' style="width:50px;padding:3px;">Lend</button>
				  		</div>
				  		</div>
				  		<div class="recent_item_footer d-flex flex-row align-items-center justify-content-start">
				  		<div><div class="recent_icon"><img src="images/icon_2.png" alt="" style="display:none;"></div><span>Type: `+rate_type_convert[loans_dict[key]["rateType"]-1]+`</span></div>
				  		<div><div class="recent_icon"><img src="images/icon_3.png" alt="" style="display:none;"></div><span>Rate: `+loans_dict[key]["interestRate"]+`%</span></div>
				  		</div>
				  		</div>
				  		</div>
				  		</div>
				  		`;
				  		if(loans_dict[key]["interestRate"]>search_interest_rate && (loans_dict[key]["rateType"] == search_interest_rate_type || search_interest_rate_type == 0) && (loans_dict[key]["amountRequest"]>search_amount_min) && (loans_dict[key]["amountRequest"]<search_amount_max || search_amount_max == 0)){
				  			$('#loans_need_lender').append(new_grid_html);
				  		}
				  	}
				}
			};

			$(function() {
				$(window).on('load',function() {
					App_current_page.init();
				});
			});
		</script>
	</body>
</html>